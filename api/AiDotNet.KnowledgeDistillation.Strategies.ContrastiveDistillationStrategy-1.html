<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Class ContrastiveDistillationStrategy&lt;T&gt; | AiDotNet Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Class ContrastiveDistillationStrategy&lt;T&gt; | AiDotNet Documentation ">
      
      <meta name="description" content="Implements Contrastive Representation Distillation (CRD) which transfers knowledge through contrastive learning of sample relationships rather than just matching outputs.">
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/ooples/AiDotNet/new/master/apiSpec/new?filename=AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1.md&amp;value=---%0Auid%3A%20AiDotNet.KnowledgeDistillation.Strategies.ContrastiveDistillationStrategy%601%0Asummary%3A%20&#39;*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax&#39;%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="ManagedReference">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../logo.svg" alt="AiDotNet">
            AiDotNet
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="AiDotNet.KnowledgeDistillation.Strategies.ContrastiveDistillationStrategy`1">



  <h1 id="AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1" data-uid="AiDotNet.KnowledgeDistillation.Strategies.ContrastiveDistillationStrategy`1" class="text-break">
Class ContrastiveDistillationStrategy&lt;T&gt;  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/KnowledgeDistillation/Strategies/ContrastiveDistillationStrategy.cs/#L67"><i class="bi bi-code-slash"></i></a>
  </h1>

  <div class="facts text-secondary">
    <dl><dt>Namespace</dt><dd><a class="xref" href="AiDotNet.html">AiDotNet</a>.<a class="xref" href="AiDotNet.KnowledgeDistillation.html">KnowledgeDistillation</a>.<a class="xref" href="AiDotNet.KnowledgeDistillation.Strategies.html">Strategies</a></dd></dl>
  <dl><dt>Assembly</dt><dd>AiDotNet.dll</dd></dl>
  </div>

  <div class="markdown summary"><p>Implements Contrastive Representation Distillation (CRD) which transfers knowledge through
contrastive learning of sample relationships rather than just matching outputs.</p>
</div>
  <div class="markdown conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public class ContrastiveDistillationStrategy&lt;T&gt; : DistillationStrategyBase&lt;T&gt;, IDistillationStrategy&lt;T&gt;, IIntermediateActivationStrategy&lt;T&gt;</code></pre>
  </div>



  <h4 class="section">Type Parameters</h4>
  <dl class="parameters">
    <dt><code>T</code></dt>
    <dd><p>The numeric type for calculations (e.g., double, float).</p>
</dd>
  </dl>

  <dl class="typelist inheritance">
    <dt>Inheritance</dt>
    <dd>
      <div><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object">object</a></div>
      <div><a class="xref" href="AiDotNet.KnowledgeDistillation.DistillationStrategyBase-1.html">DistillationStrategyBase</a>&lt;T&gt;</div>
      <div><span class="xref">ContrastiveDistillationStrategy&lt;T&gt;</span></div>
    </dd>
  </dl>

  <dl class="typelist implements">
    <dt>Implements</dt>
    <dd>
      <div><a class="xref" href="AiDotNet.Interfaces.IDistillationStrategy-1.html">IDistillationStrategy</a>&lt;T&gt;</div>
      <div><a class="xref" href="AiDotNet.Interfaces.IIntermediateActivationStrategy-1.html">IIntermediateActivationStrategy</a>&lt;T&gt;</div>
    </dd>
  </dl>


  <dl class="typelist inheritedMembers">
    <dt>Inherited Members</dt>
    <dd>
    <div>
      <a class="xref" href="AiDotNet.KnowledgeDistillation.DistillationStrategyBase-1.html#AiDotNet_KnowledgeDistillation_DistillationStrategyBase_1_NumOps">DistillationStrategyBase&lt;T&gt;.NumOps</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.KnowledgeDistillation.DistillationStrategyBase-1.html#AiDotNet_KnowledgeDistillation_DistillationStrategyBase_1_Temperature">DistillationStrategyBase&lt;T&gt;.Temperature</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.KnowledgeDistillation.DistillationStrategyBase-1.html#AiDotNet_KnowledgeDistillation_DistillationStrategyBase_1_Alpha">DistillationStrategyBase&lt;T&gt;.Alpha</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.KnowledgeDistillation.DistillationStrategyBase-1.html#AiDotNet_KnowledgeDistillation_DistillationStrategyBase_1_ValidateOutputDimensions_AiDotNet_Tensors_LinearAlgebra_Matrix__0__AiDotNet_Tensors_LinearAlgebra_Matrix__0__">DistillationStrategyBase&lt;T&gt;.ValidateOutputDimensions(Matrix&lt;T&gt;, Matrix&lt;T&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.KnowledgeDistillation.DistillationStrategyBase-1.html#AiDotNet_KnowledgeDistillation_DistillationStrategyBase_1_ValidateLabelDimensions_AiDotNet_Tensors_LinearAlgebra_Matrix__0__AiDotNet_Tensors_LinearAlgebra_Matrix__0__">DistillationStrategyBase&lt;T&gt;.ValidateLabelDimensions(Matrix&lt;T&gt;, Matrix&lt;T&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.KnowledgeDistillation.DistillationStrategyBase-1.html#AiDotNet_KnowledgeDistillation_DistillationStrategyBase_1_Epsilon">DistillationStrategyBase&lt;T&gt;.Epsilon</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.equals#system-object-equals(system-object)">object.Equals(object)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.equals#system-object-equals(system-object-system-object)">object.Equals(object, object)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.gethashcode">object.GetHashCode()</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.gettype">object.GetType()</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.memberwiseclone">object.MemberwiseClone()</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.referenceequals">object.ReferenceEquals(object, object)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.tostring">object.ToString()</a>
    </div>
  </dd></dl>




  <h2 id="AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1_remarks">Remarks</h2>
  <div class="markdown level0 remarks"><p><b>For Beginners:</b> Contrastive distillation teaches the student to understand which
samples are similar and which are different, not just to copy the teacher's predictions.
It's like learning to group things by their similarities rather than just memorizing labels.</p>
<p><b>Real-world Analogy:</b>
Instead of just teaching a student "This is a dog," you teach them "Dogs are more similar
to wolves than to cats" and "Retrievers are more similar to Labs than to Chihuahuas."
This relational understanding helps the student generalize better to new examples.</p>
<p><b>How CRD Works:</b>
1. Extract embeddings/features from teacher and student
2. For each sample (anchor), identify:
   - Positive samples: Same class or similar features
   - Negative samples: Different class or dissimilar features
3. Pull student embeddings of anchor and positives together
4. Push student embeddings of anchor and negatives apart
5. Ensure student's embedding space has same structure as teacher's</p>
<p><b>Key Differences from Standard Distillation:</b>
- **Standard**: Match output probabilities [0.1, 0.7, 0.2]
- **CRD**: Match embedding similarities and distances
- **Benefit**: Better generalization, especially for few-shot learning</p>
<p><b>Mathematical Foundation:</b>
CRD uses InfoNCE loss (Noise Contrastive Estimation):
L = -log(exp(sim(t_i, s_i)/τ) / Σ_j exp(sim(t_i, s_j)/τ))
where:
- t_i, s_i are teacher/student embeddings of sample i
- τ is temperature
- j ranges over all samples in batch</p>
<p><b>Benefits:</b>
- **Better Features**: Student learns richer representations
- **Few-Shot Learning**: Transfers better to new classes
- **Robustness**: Less sensitive to label noise
- **Interpretability**: Embedding space is more structured
- **Complementary**: Can combine with standard distillation</p>
<p><b>Use Cases:</b>
- Few-shot/zero-shot learning
- Transfer learning across domains
- Learning with noisy labels
- Metric learning tasks (face recognition, image retrieval)
- Self-supervised pre-training</p>
<p><b>Performance Improvements:</b>
- CRD often gives 2-4% better accuracy than standard distillation
- Particularly strong for small student models
- Excellent for tasks requiring good embeddings</p>
<p><b>References:</b>
- Tian et al. (2020). Contrastive Representation Distillation. ICLR.
- Chen et al. (2020). A Simple Framework for Contrastive Learning of Visual Representations. ICML.</p>
</div>


  <h2 class="section" id="constructors">Constructors
</h2>


  <a id="AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1__ctor_" data-uid="AiDotNet.KnowledgeDistillation.Strategies.ContrastiveDistillationStrategy`1.#ctor*"></a>

  <h3 id="AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1__ctor_System_String_System_Double_System_Double_System_Double_System_Int32_AiDotNet_KnowledgeDistillation_Strategies_ContrastiveMode_" data-uid="AiDotNet.KnowledgeDistillation.Strategies.ContrastiveDistillationStrategy`1.#ctor(System.String,System.Double,System.Double,System.Double,System.Int32,AiDotNet.KnowledgeDistillation.Strategies.ContrastiveMode)">
  ContrastiveDistillationStrategy(string, double, double, double, int, ContrastiveMode)
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/KnowledgeDistillation/Strategies/ContrastiveDistillationStrategy.cs/#L101"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Initializes a new instance of the ContrastiveDistillationStrategy class.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public ContrastiveDistillationStrategy(string embeddingLayerName = &quot;embeddings&quot;, double contrastiveWeight = 0.8, double temperature = 0.07, double alpha = 0.2, int negativesSampleSize = 1024, ContrastiveMode mode = ContrastiveMode.NTXent)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>embeddingLayerName</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a></dt>
    <dd><p>Name of the layer to extract embeddings from (e.g., &quot;layer_before_classifier&quot;).</p>
</dd>
    <dt><code>contrastiveWeight</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.double">double</a></dt>
    <dd><p>Weight for contrastive loss vs standard output loss (default: 0.8).</p>
</dd>
    <dt><code>temperature</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.double">double</a></dt>
    <dd><p>Temperature for contrastive softmax (default: 0.07).</p>
</dd>
    <dt><code>alpha</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.double">double</a></dt>
    <dd><p>Balance between hard and soft loss (default: 0.2).</p>
</dd>
    <dt><code>negativesSampleSize</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd><p>Number of negative samples to use (default: 1024).</p>
</dd>
    <dt><code>mode</code> <a class="xref" href="AiDotNet.KnowledgeDistillation.Strategies.ContrastiveMode.html">ContrastiveMode</a></dt>
    <dd><p>Contrastive mode (default: NTXent for label-free operation).</p>
</dd>
  </dl>








  <h4 class="section" id="AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1__ctor_System_String_System_Double_System_Double_System_Double_System_Int32_AiDotNet_KnowledgeDistillation_Strategies_ContrastiveMode__remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p><b>For Beginners:</b> Configure how much to weight contrastive learning:</p>
<p>- contrastiveWeight 0.6-0.9: More focus on learning representations
- temperature 0.05-0.1: Lower = sharper distinctions between similar/dissimilar
- negativesSampleSize 512-2048: More negatives = better discrimination</p>
<p>Example:
<pre><code class="lang-csharp">var strategy = new ContrastiveDistillationStrategy&lt;double&gt;(
    embeddingLayerName: "embedding_layer",
    contrastiveWeight: 0.8,  // 80% contrastive, 20% standard
    temperature: 0.07,        // Standard for contrastive learning
    alpha: 0.2,              // Mostly teacher knowledge
    negativesSampleSize: 1024 // Large negative set for better discrimination
);</code></pre>

</div>




  <h2 class="section" id="methods">Methods
</h2>


  <a id="AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1_ComputeContrastiveLoss_" data-uid="AiDotNet.KnowledgeDistillation.Strategies.ContrastiveDistillationStrategy`1.ComputeContrastiveLoss*"></a>

  <h3 id="AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1_ComputeContrastiveLoss_AiDotNet_Tensors_LinearAlgebra_Vector__0____AiDotNet_Tensors_LinearAlgebra_Vector__0____System_Int32___" data-uid="AiDotNet.KnowledgeDistillation.Strategies.ContrastiveDistillationStrategy`1.ComputeContrastiveLoss(AiDotNet.Tensors.LinearAlgebra.Vector{`0}[],AiDotNet.Tensors.LinearAlgebra.Vector{`0}[],System.Int32[])">
  ComputeContrastiveLoss(Vector&lt;T&gt;[], Vector&lt;T&gt;[], int[])
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/KnowledgeDistillation/Strategies/ContrastiveDistillationStrategy.cs/#L250"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Computes contrastive loss on embeddings/features.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public T ComputeContrastiveLoss(Vector&lt;T&gt;[] studentEmbeddings, Vector&lt;T&gt;[] teacherEmbeddings, int[] labels)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>studentEmbeddings</code> <a class="xref" href="AiDotNet.Tensors.LinearAlgebra.Vector-1.html">Vector</a>&lt;T&gt;[]</dt>
    <dd><p>Student embeddings for batch.</p>
</dd>
    <dt><code>teacherEmbeddings</code> <a class="xref" href="AiDotNet.Tensors.LinearAlgebra.Vector-1.html">Vector</a>&lt;T&gt;[]</dt>
    <dd><p>Teacher embeddings for batch.</p>
</dd>
    <dt><code>labels</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a>[]</dt>
    <dd><p>Sample labels for determining positives/negatives.</p>
</dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><span class="xref">T</span></dt>
    <dd><p>Contrastive loss value.</p>
</dd>
  </dl>







  <h4 class="section" id="AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1_ComputeContrastiveLoss_AiDotNet_Tensors_LinearAlgebra_Vector__0____AiDotNet_Tensors_LinearAlgebra_Vector__0____System_Int32____remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p><b>For Beginners:</b> This measures how well the student's embedding space
matches the teacher's structural relationships. Lower loss means better match.</p>
<p>The embeddings should be from intermediate layers (not final outputs),
as those contain richer representation information.</p>
</div>




  <a id="AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1_ComputeGradient_" data-uid="AiDotNet.KnowledgeDistillation.Strategies.ContrastiveDistillationStrategy`1.ComputeGradient*"></a>

  <h3 id="AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1_ComputeGradient_AiDotNet_Tensors_LinearAlgebra_Matrix__0__AiDotNet_Tensors_LinearAlgebra_Matrix__0__AiDotNet_Tensors_LinearAlgebra_Matrix__0__" data-uid="AiDotNet.KnowledgeDistillation.Strategies.ContrastiveDistillationStrategy`1.ComputeGradient(AiDotNet.Tensors.LinearAlgebra.Matrix{`0},AiDotNet.Tensors.LinearAlgebra.Matrix{`0},AiDotNet.Tensors.LinearAlgebra.Matrix{`0})">
  ComputeGradient(Matrix&lt;T&gt;, Matrix&lt;T&gt;, Matrix&lt;T&gt;?)
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/KnowledgeDistillation/Strategies/ContrastiveDistillationStrategy.cs/#L176"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Computes gradient of standard loss.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public override Matrix&lt;T&gt; ComputeGradient(Matrix&lt;T&gt; studentBatchOutput, Matrix&lt;T&gt; teacherBatchOutput, Matrix&lt;T&gt;? trueLabelsBatch = null)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>studentBatchOutput</code> <a class="xref" href="AiDotNet.Tensors.LinearAlgebra.Matrix-1.html">Matrix</a>&lt;T&gt;</dt>
    <dd></dd>
    <dt><code>teacherBatchOutput</code> <a class="xref" href="AiDotNet.Tensors.LinearAlgebra.Matrix-1.html">Matrix</a>&lt;T&gt;</dt>
    <dd></dd>
    <dt><code>trueLabelsBatch</code> <a class="xref" href="AiDotNet.Tensors.LinearAlgebra.Matrix-1.html">Matrix</a>&lt;T&gt;</dt>
    <dd></dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="AiDotNet.Tensors.LinearAlgebra.Matrix-1.html">Matrix</a>&lt;T&gt;</dt>
    <dd></dd>
  </dl>











  <a id="AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1_ComputeIntermediateGradient_" data-uid="AiDotNet.KnowledgeDistillation.Strategies.ContrastiveDistillationStrategy`1.ComputeIntermediateGradient*"></a>

  <h3 id="AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1_ComputeIntermediateGradient_AiDotNet_KnowledgeDistillation_IntermediateActivations__0__AiDotNet_KnowledgeDistillation_IntermediateActivations__0__" data-uid="AiDotNet.KnowledgeDistillation.Strategies.ContrastiveDistillationStrategy`1.ComputeIntermediateGradient(AiDotNet.KnowledgeDistillation.IntermediateActivations{`0},AiDotNet.KnowledgeDistillation.IntermediateActivations{`0})">
  ComputeIntermediateGradient(IntermediateActivations&lt;T&gt;, IntermediateActivations&lt;T&gt;)
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/KnowledgeDistillation/Strategies/ContrastiveDistillationStrategy.cs/#L510"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Computes gradients of intermediate activation loss with respect to student embeddings.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public IntermediateActivations&lt;T&gt; ComputeIntermediateGradient(IntermediateActivations&lt;T&gt; studentIntermediateActivations, IntermediateActivations&lt;T&gt; teacherIntermediateActivations)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>studentIntermediateActivations</code> <a class="xref" href="AiDotNet.KnowledgeDistillation.IntermediateActivations-1.html">IntermediateActivations</a>&lt;T&gt;</dt>
    <dd><p>Student's intermediate layer activations (must include embedding layer).</p>
</dd>
    <dt><code>teacherIntermediateActivations</code> <a class="xref" href="AiDotNet.KnowledgeDistillation.IntermediateActivations-1.html">IntermediateActivations</a>&lt;T&gt;</dt>
    <dd><p>Teacher's intermediate layer activations (must include embedding layer).</p>
</dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="AiDotNet.KnowledgeDistillation.IntermediateActivations-1.html">IntermediateActivations</a>&lt;T&gt;</dt>
    <dd><p>Gradients for the embedding layer (already weighted by contrastiveWeight).</p>
</dd>
  </dl>







  <h4 class="section" id="AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1_ComputeIntermediateGradient_AiDotNet_KnowledgeDistillation_IntermediateActivations__0__AiDotNet_KnowledgeDistillation_IntermediateActivations__0___remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>Computes analytical gradients for NT-Xent loss with respect to student embeddings.
Uses cosine similarity gradients derived from the quotient rule.</p>
<p>For NT-Xent loss L_i = -sim(s_i, t_i)/τ + log(Σ_j exp(sim(s_i, t_j)/τ)),
the gradient involves both positive and negative pair contributions.</p>
</div>




  <a id="AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1_ComputeIntermediateLoss_" data-uid="AiDotNet.KnowledgeDistillation.Strategies.ContrastiveDistillationStrategy`1.ComputeIntermediateLoss*"></a>

  <h3 id="AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1_ComputeIntermediateLoss_AiDotNet_KnowledgeDistillation_IntermediateActivations__0__AiDotNet_KnowledgeDistillation_IntermediateActivations__0__" data-uid="AiDotNet.KnowledgeDistillation.Strategies.ContrastiveDistillationStrategy`1.ComputeIntermediateLoss(AiDotNet.KnowledgeDistillation.IntermediateActivations{`0},AiDotNet.KnowledgeDistillation.IntermediateActivations{`0})">
  ComputeIntermediateLoss(IntermediateActivations&lt;T&gt;, IntermediateActivations&lt;T&gt;)
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/KnowledgeDistillation/Strategies/ContrastiveDistillationStrategy.cs/#L296"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Computes intermediate activation loss by matching embedding space structure between teacher and student.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public T ComputeIntermediateLoss(IntermediateActivations&lt;T&gt; studentIntermediateActivations, IntermediateActivations&lt;T&gt; teacherIntermediateActivations)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>studentIntermediateActivations</code> <a class="xref" href="AiDotNet.KnowledgeDistillation.IntermediateActivations-1.html">IntermediateActivations</a>&lt;T&gt;</dt>
    <dd><p>Student's intermediate layer activations (must include embedding layer).</p>
</dd>
    <dt><code>teacherIntermediateActivations</code> <a class="xref" href="AiDotNet.KnowledgeDistillation.IntermediateActivations-1.html">IntermediateActivations</a>&lt;T&gt;</dt>
    <dd><p>Teacher's intermediate layer activations (must include embedding layer).</p>
</dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><span class="xref">T</span></dt>
    <dd><p>The contrastive loss (already weighted by contrastiveWeight).</p>
</dd>
  </dl>







  <h4 class="section" id="AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1_ComputeIntermediateLoss_AiDotNet_KnowledgeDistillation_IntermediateActivations__0__AiDotNet_KnowledgeDistillation_IntermediateActivations__0___remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>This implements the IIntermediateActivationStrategy interface to properly integrate
contrastive learning into the training loop. The loss is computed from embeddings stored
in the intermediate activations for the layer specified in the constructor.</p>
<p>Uses NTXent mode by default as it doesn't require labels. Each teacher-student pair
for the same sample is treated as a positive pair, while other samples are negatives.</p>
<p>If the embedding layer is not found, returns zero loss.</p>
</div>




  <a id="AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1_ComputeLoss_" data-uid="AiDotNet.KnowledgeDistillation.Strategies.ContrastiveDistillationStrategy`1.ComputeLoss*"></a>

  <h3 id="AiDotNet_KnowledgeDistillation_Strategies_ContrastiveDistillationStrategy_1_ComputeLoss_AiDotNet_Tensors_LinearAlgebra_Matrix__0__AiDotNet_Tensors_LinearAlgebra_Matrix__0__AiDotNet_Tensors_LinearAlgebra_Matrix__0__" data-uid="AiDotNet.KnowledgeDistillation.Strategies.ContrastiveDistillationStrategy`1.ComputeLoss(AiDotNet.Tensors.LinearAlgebra.Matrix{`0},AiDotNet.Tensors.LinearAlgebra.Matrix{`0},AiDotNet.Tensors.LinearAlgebra.Matrix{`0})">
  ComputeLoss(Matrix&lt;T&gt;, Matrix&lt;T&gt;, Matrix&lt;T&gt;?)
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/KnowledgeDistillation/Strategies/ContrastiveDistillationStrategy.cs/#L126"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Computes standard output loss (contrastive loss computed separately on embeddings).</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public override T ComputeLoss(Matrix&lt;T&gt; studentBatchOutput, Matrix&lt;T&gt; teacherBatchOutput, Matrix&lt;T&gt;? trueLabelsBatch = null)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>studentBatchOutput</code> <a class="xref" href="AiDotNet.Tensors.LinearAlgebra.Matrix-1.html">Matrix</a>&lt;T&gt;</dt>
    <dd></dd>
    <dt><code>teacherBatchOutput</code> <a class="xref" href="AiDotNet.Tensors.LinearAlgebra.Matrix-1.html">Matrix</a>&lt;T&gt;</dt>
    <dd></dd>
    <dt><code>trueLabelsBatch</code> <a class="xref" href="AiDotNet.Tensors.LinearAlgebra.Matrix-1.html">Matrix</a>&lt;T&gt;</dt>
    <dd></dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><span class="xref">T</span></dt>
    <dd></dd>
  </dl>












</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/ooples/AiDotNet/blob/master/src/KnowledgeDistillation/Strategies/ContrastiveDistillationStrategy.cs/#L67" class="edit-link">Edit this page</a>
        </div>


      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          AiDotNet - Enterprise AI/ML Library for .NET
        </div>
      </div>
    </footer>
  </body>
</html>
