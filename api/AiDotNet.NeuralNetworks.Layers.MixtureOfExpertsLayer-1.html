<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Class MixtureOfExpertsLayer&lt;T&gt; | AiDotNet Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Class MixtureOfExpertsLayer&lt;T&gt; | AiDotNet Documentation ">
      
      <meta name="description" content="Implements a Mixture-of-Experts (MoE) layer that routes inputs through multiple expert networks.">
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/ooples/AiDotNet/new/master/apiSpec/new?filename=AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1.md&amp;value=---%0Auid%3A%20AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer%601%0Asummary%3A%20&#39;*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax&#39;%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="ManagedReference">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../logo.svg" alt="AiDotNet">
            AiDotNet
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1">



  <h1 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1" class="text-break">
Class MixtureOfExpertsLayer&lt;T&gt;  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L56"><i class="bi bi-code-slash"></i></a>
  </h1>

  <div class="facts text-secondary">
    <dl><dt>Namespace</dt><dd><a class="xref" href="AiDotNet.html">AiDotNet</a>.<a class="xref" href="AiDotNet.NeuralNetworks.html">NeuralNetworks</a>.<a class="xref" href="AiDotNet.NeuralNetworks.Layers.html">Layers</a></dd></dl>
  <dl><dt>Assembly</dt><dd>AiDotNet.dll</dd></dl>
  </div>

  <div class="markdown summary"><p>Implements a Mixture-of-Experts (MoE) layer that routes inputs through multiple expert networks.</p>
</div>
  <div class="markdown conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public class MixtureOfExpertsLayer&lt;T&gt; : LayerBase&lt;T&gt;, ILayer&lt;T&gt;, IJitCompilable&lt;T&gt;, IWeightLoadable&lt;T&gt;, IDisposable, IAuxiliaryLossLayer&lt;T&gt;, IDiagnosticsProvider</code></pre>
  </div>



  <h4 class="section">Type Parameters</h4>
  <dl class="parameters">
    <dt><code>T</code></dt>
    <dd><p>The numeric type used for calculations, typically float or double.</p>
</dd>
  </dl>

  <dl class="typelist inheritance">
    <dt>Inheritance</dt>
    <dd>
      <div><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object">object</a></div>
      <div><a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html">LayerBase</a>&lt;T&gt;</div>
      <div><span class="xref">MixtureOfExpertsLayer&lt;T&gt;</span></div>
    </dd>
  </dl>

  <dl class="typelist implements">
    <dt>Implements</dt>
    <dd>
      <div><a class="xref" href="AiDotNet.Interfaces.ILayer-1.html">ILayer</a>&lt;T&gt;</div>
      <div><a class="xref" href="AiDotNet.Interfaces.IJitCompilable-1.html">IJitCompilable</a>&lt;T&gt;</div>
      <div><a class="xref" href="AiDotNet.Interfaces.IWeightLoadable-1.html">IWeightLoadable</a>&lt;T&gt;</div>
      <div><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.idisposable">IDisposable</a></div>
      <div><a class="xref" href="AiDotNet.Interfaces.IAuxiliaryLossLayer-1.html">IAuxiliaryLossLayer</a>&lt;T&gt;</div>
      <div><a class="xref" href="AiDotNet.Interfaces.IDiagnosticsProvider.html">IDiagnosticsProvider</a></div>
    </dd>
  </dl>


  <dl class="typelist inheritedMembers">
    <dt>Inherited Members</dt>
    <dd>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_Engine">LayerBase&lt;T&gt;.Engine</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_ScalarActivation">LayerBase&lt;T&gt;.ScalarActivation</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_VectorActivation">LayerBase&lt;T&gt;.VectorActivation</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_UsingVectorActivation">LayerBase&lt;T&gt;.UsingVectorActivation</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_NumOps">LayerBase&lt;T&gt;.NumOps</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_Random">LayerBase&lt;T&gt;.Random</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_Parameters">LayerBase&lt;T&gt;.Parameters</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_ParameterGradients">LayerBase&lt;T&gt;.ParameterGradients</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_InputShape">LayerBase&lt;T&gt;.InputShape</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_InputShapes">LayerBase&lt;T&gt;.InputShapes</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_UpdateInputShape_System_Int32___">LayerBase&lt;T&gt;.UpdateInputShape(int[])</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_OutputShape">LayerBase&lt;T&gt;.OutputShape</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_IsTrainingMode">LayerBase&lt;T&gt;.IsTrainingMode</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_InitializationStrategy">LayerBase&lt;T&gt;.InitializationStrategy</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_IsInitialized">LayerBase&lt;T&gt;.IsInitialized</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_InitializationLock">LayerBase&lt;T&gt;.InitializationLock</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_EnsureInitialized">LayerBase&lt;T&gt;.EnsureInitialized()</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_UseAutodiff">LayerBase&lt;T&gt;.UseAutodiff</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_SetTrainingMode_System_Boolean_">LayerBase&lt;T&gt;.SetTrainingMode(bool)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_GetParameterGradients">LayerBase&lt;T&gt;.GetParameterGradients()</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_ClearGradients">LayerBase&lt;T&gt;.ClearGradients()</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_GetInputShape">LayerBase&lt;T&gt;.GetInputShape()</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_GetInputShapes">LayerBase&lt;T&gt;.GetInputShapes()</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_GetOutputShape">LayerBase&lt;T&gt;.GetOutputShape()</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_GetWeights">LayerBase&lt;T&gt;.GetWeights()</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_GetBiases">LayerBase&lt;T&gt;.GetBiases()</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_MapActivationToFused">LayerBase&lt;T&gt;.MapActivationToFused()</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_SupportsGpuExecution">LayerBase&lt;T&gt;.SupportsGpuExecution</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_SupportsGpuTraining">LayerBase&lt;T&gt;.SupportsGpuTraining</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_CanExecuteOnGpu">LayerBase&lt;T&gt;.CanExecuteOnGpu</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_CanTrainOnGpu">LayerBase&lt;T&gt;.CanTrainOnGpu</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_BackwardGpu_AiDotNet_Tensors_Engines_Gpu_IGpuTensor__0__">LayerBase&lt;T&gt;.BackwardGpu(IGpuTensor&lt;T&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_UpdateParametersGpu_AiDotNet_Interfaces_IGpuOptimizerConfig_">LayerBase&lt;T&gt;.UpdateParametersGpu(IGpuOptimizerConfig)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_UploadWeightsToGpu">LayerBase&lt;T&gt;.UploadWeightsToGpu()</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_DownloadWeightsFromGpu">LayerBase&lt;T&gt;.DownloadWeightsFromGpu()</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_ZeroGradientsGpu">LayerBase&lt;T&gt;.ZeroGradientsGpu()</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_GetActivationTypes">LayerBase&lt;T&gt;.GetActivationTypes()</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_Forward_AiDotNet_Tensors_LinearAlgebra_Tensor__0____">LayerBase&lt;T&gt;.Forward(params Tensor&lt;T&gt;[])</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_ApplyActivation_AiDotNet_Tensors_LinearAlgebra_Tensor__0__">LayerBase&lt;T&gt;.ApplyActivation(Tensor&lt;T&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_ApplyActivation_AiDotNet_Tensors_LinearAlgebra_Vector__0__">LayerBase&lt;T&gt;.ApplyActivation(Vector&lt;T&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_ActivateTensor_AiDotNet_Interfaces_IActivationFunction__0__AiDotNet_Tensors_LinearAlgebra_Tensor__0__">LayerBase&lt;T&gt;.ActivateTensor(IActivationFunction&lt;T&gt;, Tensor&lt;T&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_ActivateTensor_AiDotNet_Interfaces_IVectorActivationFunction__0__AiDotNet_Tensors_LinearAlgebra_Tensor__0__">LayerBase&lt;T&gt;.ActivateTensor(IVectorActivationFunction&lt;T&gt;, Tensor&lt;T&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_CalculateInputShape_System_Int32_System_Int32_System_Int32_">LayerBase&lt;T&gt;.CalculateInputShape(int, int, int)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_CalculateOutputShape_System_Int32_System_Int32_System_Int32_">LayerBase&lt;T&gt;.CalculateOutputShape(int, int, int)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_DerivativeTensor_AiDotNet_Interfaces_IActivationFunction__0__AiDotNet_Tensors_LinearAlgebra_Tensor__0__">LayerBase&lt;T&gt;.DerivativeTensor(IActivationFunction&lt;T&gt;, Tensor&lt;T&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_ApplyActivationDerivative__0__0_">LayerBase&lt;T&gt;.ApplyActivationDerivative(T, T)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_ApplyActivationDerivative_AiDotNet_Tensors_LinearAlgebra_Tensor__0__AiDotNet_Tensors_LinearAlgebra_Tensor__0__">LayerBase&lt;T&gt;.ApplyActivationDerivative(Tensor&lt;T&gt;, Tensor&lt;T&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_ComputeActivationJacobian_AiDotNet_Tensors_LinearAlgebra_Vector__0__">LayerBase&lt;T&gt;.ComputeActivationJacobian(Vector&lt;T&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_ApplyActivationDerivative_AiDotNet_Tensors_LinearAlgebra_Vector__0__AiDotNet_Tensors_LinearAlgebra_Vector__0__">LayerBase&lt;T&gt;.ApplyActivationDerivative(Vector&lt;T&gt;, Vector&lt;T&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_UpdateParameters_AiDotNet_Tensors_LinearAlgebra_Vector__0__">LayerBase&lt;T&gt;.UpdateParameters(Vector&lt;T&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_Serialize_System_IO_BinaryWriter_">LayerBase&lt;T&gt;.Serialize(BinaryWriter)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_Deserialize_System_IO_BinaryReader_">LayerBase&lt;T&gt;.Deserialize(BinaryReader)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_ApplyActivationToGraph_AiDotNet_Autodiff_ComputationNode__0__">LayerBase&lt;T&gt;.ApplyActivationToGraph(ComputationNode&lt;T&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_CanActivationBeJitted">LayerBase&lt;T&gt;.CanActivationBeJitted()</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_RegisterTrainableParameter_AiDotNet_Tensors_LinearAlgebra_Tensor__0__AiDotNet_Tensors_Engines_PersistentTensorRole_">LayerBase&lt;T&gt;.RegisterTrainableParameter(Tensor&lt;T&gt;, PersistentTensorRole)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_InvalidateTrainableParameter_AiDotNet_Tensors_LinearAlgebra_Tensor__0__">LayerBase&lt;T&gt;.InvalidateTrainableParameter(Tensor&lt;T&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_HasGpuActivation">LayerBase&lt;T&gt;.HasGpuActivation()</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_ApplyActivationForwardGpu_AiDotNet_Tensors_Engines_DirectGpu_IDirectGpuBackend_AiDotNet_Tensors_Engines_DirectGpu_IGpuBuffer_AiDotNet_Tensors_Engines_DirectGpu_IGpuBuffer_System_Int32_">LayerBase&lt;T&gt;.ApplyActivationForwardGpu(IDirectGpuBackend, IGpuBuffer, IGpuBuffer, int)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_ApplyActivationBackwardGpu_AiDotNet_Tensors_Engines_DirectGpu_IDirectGpuBackend_AiDotNet_Tensors_Engines_DirectGpu_IGpuBuffer_AiDotNet_Tensors_Engines_DirectGpu_IGpuBuffer_AiDotNet_Tensors_Engines_DirectGpu_IGpuBuffer_AiDotNet_Tensors_Engines_DirectGpu_IGpuBuffer_System_Int32_">LayerBase&lt;T&gt;.ApplyActivationBackwardGpu(IDirectGpuBackend, IGpuBuffer, IGpuBuffer, IGpuBuffer, IGpuBuffer, int)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_GetFusedActivationType">LayerBase&lt;T&gt;.GetFusedActivationType()</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_ApplyGpuActivation_AiDotNet_Tensors_Engines_DirectGpu_IDirectGpuBackend_AiDotNet_Tensors_Engines_DirectGpu_IGpuBuffer_AiDotNet_Tensors_Engines_DirectGpu_IGpuBuffer_System_Int32_AiDotNet_Tensors_Engines_FusedActivationType_">LayerBase&lt;T&gt;.ApplyGpuActivation(IDirectGpuBackend, IGpuBuffer, IGpuBuffer, int, FusedActivationType)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_ApplyGpuActivationBackward_AiDotNet_Tensors_Engines_DirectGpu_IDirectGpuBackend_AiDotNet_Tensors_Engines_DirectGpu_IGpuBuffer_AiDotNet_Tensors_Engines_DirectGpu_IGpuBuffer_AiDotNet_Tensors_Engines_DirectGpu_IGpuBuffer_AiDotNet_Tensors_Engines_DirectGpu_IGpuBuffer_System_Int32_AiDotNet_Tensors_Engines_FusedActivationType_System_Single_">LayerBase&lt;T&gt;.ApplyGpuActivationBackward(IDirectGpuBackend, IGpuBuffer, IGpuBuffer, IGpuBuffer, IGpuBuffer, int, FusedActivationType, float)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_Dispose">LayerBase&lt;T&gt;.Dispose()</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_Dispose_System_Boolean_">LayerBase&lt;T&gt;.Dispose(bool)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_WeightParameterName">LayerBase&lt;T&gt;.WeightParameterName</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_BiasParameterName">LayerBase&lt;T&gt;.BiasParameterName</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_SetWeights_AiDotNet_Tensors_LinearAlgebra_Tensor__0__">LayerBase&lt;T&gt;.SetWeights(Tensor&lt;T&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_SetBiases_AiDotNet_Tensors_LinearAlgebra_Tensor__0__">LayerBase&lt;T&gt;.SetBiases(Tensor&lt;T&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_GetParameterNames">LayerBase&lt;T&gt;.GetParameterNames()</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_TryGetParameter_System_String_AiDotNet_Tensors_LinearAlgebra_Tensor__0___">LayerBase&lt;T&gt;.TryGetParameter(string, out Tensor&lt;T&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_SetParameter_System_String_AiDotNet_Tensors_LinearAlgebra_Tensor__0__">LayerBase&lt;T&gt;.SetParameter(string, Tensor&lt;T&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_GetParameterShape_System_String_">LayerBase&lt;T&gt;.GetParameterShape(string)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_NamedParameterCount">LayerBase&lt;T&gt;.NamedParameterCount</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_ValidateWeights_System_Collections_Generic_IEnumerable_System_String__System_Func_System_String_System_String__">LayerBase&lt;T&gt;.ValidateWeights(IEnumerable&lt;string&gt;, Func&lt;string, string&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_LoadWeights_System_Collections_Generic_Dictionary_System_String_AiDotNet_Tensors_LinearAlgebra_Tensor__0___System_Func_System_String_System_String__System_Boolean_">LayerBase&lt;T&gt;.LoadWeights(Dictionary&lt;string, Tensor&lt;T&gt;&gt;, Func&lt;string, string&gt;, bool)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.equals#system-object-equals(system-object)">object.Equals(object)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.equals#system-object-equals(system-object-system-object)">object.Equals(object, object)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.gethashcode">object.GetHashCode()</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.gettype">object.GetType()</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.memberwiseclone">object.MemberwiseClone()</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.referenceequals">object.ReferenceEquals(object, object)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.tostring">object.ToString()</a>
    </div>
  </dd></dl>




  <h2 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_remarks">Remarks</h2>
  <div class="markdown level0 remarks"><p>
A Mixture-of-Experts layer contains multiple expert networks and a gating/routing network.
For each input, the router determines how much weight to give each expert's output,
allowing the model to specialize different experts for different types of inputs.
This architecture enables models with very high capacity while remaining computationally efficient
by activating only a subset of parameters per input.
</p>
<p>
<b>For Beginners:</b> Think of a Mixture-of-Experts as a team of specialists working together.
<p>How it works:</p>
<ul>
<li>You have multiple &quot;experts&quot; (specialized neural networks)</li>
<li>A &quot;router&quot; (gating network) decides which experts should handle each input</li>
<li>Each expert processes the input independently</li>
<li>The final output is a weighted combination of the experts' outputs</li>
</ul>
<p>Why use MoE:</p>
<ul>
<li>Scalability: Add more experts to increase model capacity without proportionally increasing computation</li>
<li>Specialization: Different experts learn to handle different types of inputs</li>
<li>Efficiency: Only activate the most relevant experts for each input (sparse MoE)</li>
</ul>
<p>Real-world analogy:
Imagine you're running a hospital with specialists:</p>
<ul>
<li>A cardiologist (expert 1) handles heart problems</li>
<li>A neurologist (expert 2) handles brain issues</li>
<li>A pediatrician (expert 3) handles children's health</li>
<li>A triage nurse (router) directs patients to the right specialist(s)</li>
</ul>
<p>The router learns to send cardiac patients to the cardiologist, neurological cases to the
neurologist, etc. This is more efficient than having one doctor handle everything, and allows
each specialist to become highly skilled in their area.</p>

<p>
<b>Key Features:</b>
<ul><li>Support for any number of experts</li><li>Learned routing via a dense gating network</li><li>Softmax routing: All experts contribute with learned weights</li><li>Top-K routing: Only the top K experts are activated per input</li><li>Load balancing: Optional auxiliary loss to encourage balanced expert usage</li></ul>

</div>


  <h2 class="section" id="constructors">Constructors
</h2>


  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1__ctor_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.#ctor*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1__ctor_System_Collections_Generic_List_AiDotNet_Interfaces_ILayer__0___AiDotNet_Interfaces_ILayer__0__System_Int32___System_Int32___System_Int32_AiDotNet_Interfaces_IActivationFunction__0__System_Boolean__0_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.#ctor(System.Collections.Generic.List{AiDotNet.Interfaces.ILayer{`0}},AiDotNet.Interfaces.ILayer{`0},System.Int32[],System.Int32[],System.Int32,AiDotNet.Interfaces.IActivationFunction{`0},System.Boolean,`0)">
  MixtureOfExpertsLayer(List&lt;ILayer&lt;T&gt;&gt;, ILayer&lt;T&gt;, int[], int[], int, IActivationFunction&lt;T&gt;?, bool, T?)
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L417"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Initializes a new instance of the <a class="xref" href="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer-1.html">MixtureOfExpertsLayer&lt;T&gt;</a> class.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public MixtureOfExpertsLayer(List&lt;ILayer&lt;T&gt;&gt; experts, ILayer&lt;T&gt; router, int[] inputShape, int[] outputShape, int topK = 0, IActivationFunction&lt;T&gt;? activationFunction = null, bool useLoadBalancing = false, T? loadBalancingWeight = default)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>experts</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.collections.generic.list-1">List</a>&lt;<a class="xref" href="AiDotNet.Interfaces.ILayer-1.html">ILayer</a>&lt;T&gt;&gt;</dt>
    <dd><p>The list of expert networks.</p>
</dd>
    <dt><code>router</code> <a class="xref" href="AiDotNet.Interfaces.ILayer-1.html">ILayer</a>&lt;T&gt;</dt>
    <dd><p>The routing/gating network.</p>
</dd>
    <dt><code>inputShape</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a>[]</dt>
    <dd><p>The shape of input tensors.</p>
</dd>
    <dt><code>outputShape</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a>[]</dt>
    <dd><p>The shape of output tensors.</p>
</dd>
    <dt><code>topK</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd><p>Number of experts to activate per input (0 = use all experts). Default is 0.</p>
</dd>
    <dt><code>activationFunction</code> <a class="xref" href="AiDotNet.Interfaces.IActivationFunction-1.html">IActivationFunction</a>&lt;T&gt;</dt>
    <dd><p>Optional activation function to apply after combining expert outputs.</p>
</dd>
    <dt><code>useLoadBalancing</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.boolean">bool</a></dt>
    <dd></dd>
    <dt><code>loadBalancingWeight</code> <span class="xref">T</span></dt>
    <dd></dd>
  </dl>








  <h4 class="section" id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1__ctor_System_Collections_Generic_List_AiDotNet_Interfaces_ILayer__0___AiDotNet_Interfaces_ILayer__0__System_Int32___System_Int32___System_Int32_AiDotNet_Interfaces_IActivationFunction__0__System_Boolean__0__remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
Creates a Mixture-of-Experts layer with the specified experts and router. All experts should
have compatible input/output shapes. The router should output a tensor with one value per expert.
</p>
<p><b>For Beginners:</b> This creates a new MoE layer with your chosen experts and router.
<p>To create an MoE layer:</p>
<ol>
<li>Create your expert networks (can be any ILayer&lt;T&gt;, often Expert&lt;T&gt; or DenseLayer&lt;T&gt;)</li>
<li>Create a router (typically a DenseLayer that outputs numExperts values)</li>
<li>Specify input/output shapes</li>
<li>Optionally set topK for sparse routing</li>
</ol>
<p>Example - MoE with 4 experts and Top-2 routing:</p>
<pre><code class="lang-csharp">// Create 4 expert networks
var experts = new List&lt;ILayer&lt;float&gt;&gt;();
for (int i = 0; i &lt; 4; i++)
{
    var expertLayers = new List&lt;ILayer&lt;float&gt;&gt;
    {
        new DenseLayer&lt;float&gt;(128, 256, new ReLUActivation&lt;float&gt;()),
        new DenseLayer&lt;float&gt;(256, 128, new ReLUActivation&lt;float&gt;())
    };
    experts.Add(new ExpertLayer&lt;float&gt;(expertLayers, new[] { 128 }, new[] { 128 }));
}

// Create router that outputs 4 scores (one per expert)
var router = new DenseLayer&lt;float&gt;(128, 4);

// Create MoE layer with Top-2 routing
var moe = new MixtureOfExpertsLayer&lt;float&gt;(
    experts, router,
    new[] { 128 }, new[] { 128 },
    topK: 2
);</code></pre>

</div>

  <h4 class="section">Exceptions</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.argumentexception">ArgumentException</a></dt>
    <dd><p>Thrown when the experts list is empty or when topK is invalid.</p>
</dd>
  </dl>



  <h2 class="section" id="properties">Properties
</h2>


  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_AuxiliaryLossWeight_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.AuxiliaryLossWeight*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_AuxiliaryLossWeight" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.AuxiliaryLossWeight">
  AuxiliaryLossWeight
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L1055"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Gets or sets the weight for the auxiliary load balancing loss.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public T AuxiliaryLossWeight { get; set; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><span class="xref">T</span></dt>
    <dd><p>The coefficient that determines how much the load balancing loss influences training.</p>
</dd>
  </dl>




  <h4 class="section" id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_AuxiliaryLossWeight_remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
This weight is multiplied by the load balancing loss before adding it to the primary loss.
Typical values range from 0.01 to 0.1. Higher values enforce stronger load balancing.
</p>
<p><b>For Beginners:</b> Controls the importance of load balancing.
<p>Recommended starting value: 0.01</p>
<p>Tuning guidelines:</p>
<ul>
<li>If experts are very imbalanced: increase (e.g., 0.05 or 0.1)</li>
<li>If primary task accuracy suffers: decrease (e.g., 0.005)</li>
<li>Monitor both primary loss and expert usage statistics to find the right balance</li>
</ul>

</div>




  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_NumExperts_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.NumExperts*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_NumExperts" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.NumExperts">
  NumExperts
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L366"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Gets the number of experts in this MoE layer.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public int NumExperts { get; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd><p>The count of expert networks.</p>
</dd>
  </dl>




  <h4 class="section" id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_NumExperts_remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
This is the total number of expert networks, regardless of how many are activated per input.
</p>
<p><b>For Beginners:</b> How many specialist networks are available.
<p>Common configurations:</p>
<ul>
<li>Small models: 4-8 experts</li>
<li>Medium models: 8-16 experts</li>
<li>Large models: 32-128+ experts</li>
</ul>
<p>The number of experts affects:</p>
<ul>
<li>Model capacity (more experts = more capacity)</li>
<li>Memory usage (more experts = more memory)</li>
<li>Specialization potential (more experts = more specialized roles)</li>
</ul>

</div>




  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_ParameterCount_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.ParameterCount*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_ParameterCount" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.ParameterCount">
  ParameterCount
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L341"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Gets the total number of trainable parameters in the layer.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public override int ParameterCount { get; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd><p>The sum of the router's parameters and all experts' parameters.</p>
</dd>
  </dl>




  <h4 class="section" id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_ParameterCount_remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
This includes all parameters from the router and all experts combined. This gives you the
total model capacity and memory requirement for this layer.
</p>
<p><b>For Beginners:</b> The total count of all adjustable numbers in this layer.
<p>This includes:</p>
<ul>
<li>All weights and biases in the router</li>
<li>All weights and biases in all experts</li>
</ul>
<p>For example, with:</p>
<ul>
<li>Router: 1000 parameters</li>
<li>8 experts with 5000 parameters each: 40,000 parameters</li>
<li>Total: 41,000 parameters</li>
</ul>
<p>More parameters = more capacity to learn, but also more memory needed.
MoE shines because you can have huge capacity (many experts) but still only activate
a fraction of them per input with sparse routing.</p>

</div>




  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_SupportsJitCompilation_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.SupportsJitCompilation*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_SupportsJitCompilation" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.SupportsJitCompilation">
  SupportsJitCompilation
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L2177"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Gets a value indicating whether this layer supports JIT compilation.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public override bool SupportsJitCompilation { get; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.boolean">bool</a></dt>
    <dd><p><code>true</code> if both the router and all experts support JIT compilation; otherwise, <code>false</code>.</p>
</dd>
  </dl>




  <h4 class="section" id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_SupportsJitCompilation_remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
JIT compilation for MoE uses TopKSoftmax for differentiable expert selection.
The routing is performed by the router network, and the selected experts'
outputs are weighted by the softmax-normalized routing scores.
</p>
</div>




  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_SupportsTraining_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.SupportsTraining*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_SupportsTraining" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.SupportsTraining">
  SupportsTraining
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L312"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Gets a value indicating whether this layer supports training.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public override bool SupportsTraining { get; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.boolean">bool</a></dt>
    <dd><p><code>true</code> if the router or any expert supports training; otherwise, <code>false</code>.</p>
</dd>
  </dl>




  <h4 class="section" id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_SupportsTraining_remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
The MoE layer supports training if either its router or any of its experts have trainable parameters.
</p>
<p><b>For Beginners:</b> This tells you if the MoE layer can learn from data.
<p>The layer can learn if:</p>
<ul>
<li>The router can learn better routing decisions</li>
<li>Any expert can improve its predictions</li>
</ul>
<p>In almost all practical cases, this will be true since both the router and experts
typically have trainable parameters.</p>

</div>




  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_UseAuxiliaryLoss_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.UseAuxiliaryLoss*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_UseAuxiliaryLoss" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.UseAuxiliaryLoss">
  UseAuxiliaryLoss
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L1028"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Gets or sets a value indicating whether to use the auxiliary load balancing loss.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public bool UseAuxiliaryLoss { get; set; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.boolean">bool</a></dt>
    <dd><p><code>true</code> to compute and apply load balancing loss during training; otherwise, <code>false</code>.</p>
</dd>
  </dl>




  <h4 class="section" id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_UseAuxiliaryLoss_remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
When enabled, the layer computes a load balancing loss that encourages balanced expert usage.
This loss is added to the primary task loss during training to prevent expert imbalance.
</p>
<p><b>For Beginners:</b> Turn load balancing on or off.
<p>Enable this during training to ensure all experts are used roughly equally.
Disable during inference/testing since load balancing is only needed during training.</p>
<p>Benefits of load balancing:</p>
<ul>
<li>Prevents expert collapse (all inputs routed to the same expert)</li>
<li>Encourages specialization across different experts</li>
<li>Improves overall model quality and generalization</li>
</ul>

</div>




  <h2 class="section" id="methods">Methods
</h2>


  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_Backward_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.Backward*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_Backward_AiDotNet_Tensors_LinearAlgebra_Tensor__0__" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.Backward(AiDotNet.Tensors.LinearAlgebra.Tensor{`0})">
  Backward(Tensor&lt;T&gt;)
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L665"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Performs the backward pass through the MoE layer.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public override Tensor&lt;T&gt; Backward(Tensor&lt;T&gt; outputGradient)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>outputGradient</code> <a class="xref" href="AiDotNet.Tensors.LinearAlgebra.Tensor-1.html">Tensor</a>&lt;T&gt;</dt>
    <dd><p>The gradient of the loss with respect to this layer's output.</p>
</dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="AiDotNet.Tensors.LinearAlgebra.Tensor-1.html">Tensor</a>&lt;T&gt;</dt>
    <dd><p>The gradient of the loss with respect to this layer's input.</p>
</dd>
  </dl>







  <h4 class="section" id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_Backward_AiDotNet_Tensors_LinearAlgebra_Tensor__0___remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
The backward pass:
1. Applies the derivative of the activation function
2. Computes gradients for each expert's contribution
3. Backpropagates through active experts
4. Computes gradients for the router
5. Backpropagates through the router
6. Returns the combined input gradient
</p>
<p><b>For Beginners:</b> This is where the MoE layer learns from its mistakes.
<p>The backward pass works in reverse:</p>
<ol>
<li><p><b>Receive Error Signal:</b> Get information about how wrong the output was</p>
<ul>
<li>This comes from layers after this one (or from the loss function)</li>
</ul>
</li>
<li><p><b>Activation Gradient:</b> Account for the activation function</p>
<ul>
<li>If we applied ReLU, apply its derivative</li>
<li>This adjusts the error signal appropriately</li>
</ul>
</li>
<li><p><b>Expert Gradients:</b> Calculate how each expert should improve</p>
<ul>
<li>Weight the error by how much each expert contributed</li>
<li>Expert with weight 0.7 gets more of the blame/credit than one with 0.1</li>
<li>Send these weighted errors back through each expert</li>
</ul>
</li>
<li><p><b>Router Gradients:</b> Calculate how routing should improve</p>
<ul>
<li>If expert 1 was useful, increase its future routing weight for similar inputs</li>
<li>If expert 3 was harmful, decrease its future routing weight</li>
<li>This helps the router make better decisions next time</li>
</ul>
</li>
<li><p><b>Combine Input Gradients:</b> Sum up gradients from router and experts</p>
<ul>
<li>This tells earlier layers how they should adjust</li>
</ul>
</li>
</ol>
<p>After backward pass completes, all components know how to improve, but haven't
changed yet. The actual changes happen in UpdateParameters().</p>

</div>

  <h4 class="section">Exceptions</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.invalidoperationexception">InvalidOperationException</a></dt>
    <dd><p>Thrown when backward is called before forward.</p>
</dd>
  </dl>



  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_Clone_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.Clone*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_Clone" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.Clone">
  Clone()
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L974"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Creates a deep copy of this MoE layer.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public override LayerBase&lt;T&gt; Clone()</code></pre>
  </div>


  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html">LayerBase</a>&lt;T&gt;</dt>
    <dd><p>A new MixtureOfExpertsLayer with the same configuration and parameters.</p>
</dd>
  </dl>







  <h4 class="section" id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_Clone_remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
Creates an independent copy of this layer, including the router and all experts.
Changes to the clone won't affect the original.
</p>
<p><b>For Beginners:</b> Makes an identical copy of the entire MoE layer.
<p>The clone includes:</p>
<ul>
<li>A copy of the router</li>
<li>Copies of all experts</li>
<li>Same configuration (TopK, shapes, etc.)</li>
<li>Same learned parameters</li>
</ul>
<p>Useful for:</p>
<ul>
<li>Creating an ensemble of similar models</li>
<li>Experimenting with different training approaches</li>
<li>Saving checkpoints during training</li>
<li>Implementing certain meta-learning algorithms</li>
</ul>
<p>The clone is completely independent - training one won't affect the other.</p>

</div>




  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_ComputeAuxiliaryLoss_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.ComputeAuxiliaryLoss*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_ComputeAuxiliaryLoss" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.ComputeAuxiliaryLoss">
  ComputeAuxiliaryLoss()
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L1107"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Computes the load balancing auxiliary loss based on expert usage from the last forward pass.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public T ComputeAuxiliaryLoss()</code></pre>
  </div>


  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><span class="xref">T</span></dt>
    <dd><p>The load balancing loss value.</p>
</dd>
  </dl>







  <h4 class="section" id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_ComputeAuxiliaryLoss_remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
The load balancing loss encourages balanced expert usage by penalizing imbalanced routing.
It is computed as the dot product of two fractions for each expert:
- Token fraction: Proportion of tokens (inputs) routed to this expert
- Probability mass fraction: Average routing probability for this expert
<p>Loss = NumExperts * sum(token_fraction_i * prob_mass_fraction_i) for all experts i</p>
<p>This loss is minimized when all experts receive equal numbers of tokens and equal
total probability mass, encouraging balanced utilization.</p>

<p><b>For Beginners:</b> Calculates a penalty for imbalanced expert usage.
<p>How it works:</p>
<ol>
<li><p><b>Count Token Assignments:</b></p>
<ul>
<li>For each expert, count how many inputs chose it (with Top-K) or had non-zero weight</li>
<li>Example with 8 inputs and 4 experts: [3, 2, 2, 1] tokens per expert</li>
</ul>
</li>
<li><p><b>Calculate Probability Mass:</b></p>
<ul>
<li>For each expert, sum up its routing weights across all inputs</li>
<li>Example: [0.4, 0.3, 0.2, 0.1] total probability per expert</li>
</ul>
</li>
<li><p><b>Compute Load Balancing Loss:</b></p>
<ul>
<li>Convert counts to fractions: [3/8, 2/8, 2/8, 1/8] = [0.375, 0.25, 0.25, 0.125]</li>
<li>Convert probabilities to fractions: [0.4, 0.3, 0.2, 0.1]</li>
<li>Dot product: 0.375<em>0.4 + 0.25</em>0.3 + 0.25<em>0.2 + 0.125</em>0.1</li>
<li>Multiply by numExperts (4): gives load balancing loss</li>
</ul>
</li>
</ol>
<p>Why this works:</p>
<ul>
<li>If all experts are used equally, both fractions are [0.25, 0.25, 0.25, 0.25]</li>
<li>Dot product: 0.25*0.25 * 4 = 0.25 (minimum possible)</li>
<li>If imbalanced like [0.5, 0.3, 0.15, 0.05]  [0.6, 0.25, 0.1, 0.05]</li>
<li>Dot product: 0.5*0.6 + ... = higher value (penalty for imbalance)</li>
</ul>
<p>The loss is minimized when usage is perfectly balanced!</p>

</div>

  <h4 class="section">Exceptions</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.invalidoperationexception">InvalidOperationException</a></dt>
    <dd><p>Thrown when called before a forward pass or when auxiliary loss is disabled.</p>
</dd>
  </dl>



  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_ExportComputationGraph_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.ExportComputationGraph*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_ExportComputationGraph_System_Collections_Generic_List_AiDotNet_Autodiff_ComputationNode__0___" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.ExportComputationGraph(System.Collections.Generic.List{AiDotNet.Autodiff.ComputationNode{`0}})">
  ExportComputationGraph(List&lt;ComputationNode&lt;T&gt;&gt;)
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L2097"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Exports the layer's computation graph for JIT compilation.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public override ComputationNode&lt;T&gt; ExportComputationGraph(List&lt;ComputationNode&lt;T&gt;&gt; inputNodes)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>inputNodes</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.collections.generic.list-1">List</a>&lt;<a class="xref" href="AiDotNet.Autodiff.ComputationNode-1.html">ComputationNode</a>&lt;T&gt;&gt;</dt>
    <dd><p>List to populate with input computation nodes.</p>
</dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="AiDotNet.Autodiff.ComputationNode-1.html">ComputationNode</a>&lt;T&gt;</dt>
    <dd><p>The output computation node representing the layer's operation.</p>
</dd>
  </dl>







  <h4 class="section" id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_ExportComputationGraph_System_Collections_Generic_List_AiDotNet_Autodiff_ComputationNode__0____remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
This method constructs a computation graph representation of the layer's forward pass
that can be JIT compiled for faster inference. All layers MUST implement this method
to support JIT compilation.
</p>
<p><b>For Beginners:</b> JIT (Just-In-Time) compilation converts the layer's operations
into optimized native code for 5-10x faster inference.
<p>To support JIT compilation, a layer must:</p>
<ol>
<li>Implement this method to export its computation graph</li>
<li>Set SupportsJitCompilation to true</li>
<li>Use ComputationNode and TensorOperations to build the graph</li>
</ol>
<p>All layers are required to implement this method, even if they set SupportsJitCompilation = false.</p>

</div>




  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_Forward_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.Forward*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_Forward_AiDotNet_Tensors_LinearAlgebra_Tensor__0__" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.Forward(AiDotNet.Tensors.LinearAlgebra.Tensor{`0})">
  Forward(Tensor&lt;T&gt;)
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L499"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Performs the forward pass through the MoE layer.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public override Tensor&lt;T&gt; Forward(Tensor&lt;T&gt; input)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>input</code> <a class="xref" href="AiDotNet.Tensors.LinearAlgebra.Tensor-1.html">Tensor</a>&lt;T&gt;</dt>
    <dd><p>The input tensor.</p>
</dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="AiDotNet.Tensors.LinearAlgebra.Tensor-1.html">Tensor</a>&lt;T&gt;</dt>
    <dd><p>The output tensor after routing through experts and combining their outputs.</p>
</dd>
  </dl>







  <h4 class="section" id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_Forward_AiDotNet_Tensors_LinearAlgebra_Tensor__0___remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
The forward pass:
1. Routes the input through the gating network to get expert scores
2. Applies softmax to convert scores to routing probabilities
3. Optionally selects only top-K experts (sparse routing)
4. Passes input through selected experts
5. Combines expert outputs using routing weights
6. Applies the layer's activation function
</p>
<p><b>For Beginners:</b> This is where the MoE layer processes input data.
<p>Step-by-step process:</p>
<ol>
<li><p><b>Routing:</b> The router looks at the input and scores each expert</p>
<ul>
<li>Input: data to process</li>
<li>Output: a score for each expert (raw numbers)</li>
</ul>
</li>
<li><p><b>Normalization:</b> Convert scores to probabilities using softmax</p>
<ul>
<li>Scores: might be [2.1, -0.5, 1.3, 0.8]</li>
<li>Weights: becomes [0.55, 0.04, 0.26, 0.15] (sum = 1.0)</li>
</ul>
</li>
<li><p><b>Selection (if using Top-K):</b> Keep only the best K experts</p>
<ul>
<li>With Top-2, keep experts with weights 0.55 and 0.26</li>
<li>Set others to 0 and renormalize: [0.68, 0, 0.32, 0]</li>
</ul>
</li>
<li><p><b>Expert Processing:</b> Run input through selected experts</p>
<ul>
<li>Expert 1 produces output A</li>
<li>Expert 3 produces output B</li>
<li>Others are skipped (if using Top-K)</li>
</ul>
</li>
<li><p><b>Combination:</b> Mix expert outputs using weights</p>
<ul>
<li>Output = 0.68 * A + 0.32 * B</li>
<li>This is the weighted average of expert predictions</li>
</ul>
</li>
<li><p><b>Activation:</b> Apply final transformation</p>
<ul>
<li>Usually identity (no change) or ReLU</li>
</ul>
</li>
</ol>
<p>The result is a smart combination of expert predictions, where each expert
contributes based on its relevance to the specific input.</p>

</div>




  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_ForwardGpu_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.ForwardGpu*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_ForwardGpu_AiDotNet_Tensors_Engines_Gpu_IGpuTensor__0____" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.ForwardGpu(AiDotNet.Tensors.Engines.Gpu.IGpuTensor{`0}[])">
  ForwardGpu(params IGpuTensor&lt;T&gt;[])
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L1817"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Performs the forward pass on GPU tensors by routing through experts.
All computations stay GPU-resident for maximum performance.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public override IGpuTensor&lt;T&gt; ForwardGpu(params IGpuTensor&lt;T&gt;[] inputs)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>inputs</code> <a class="xref" href="AiDotNet.Tensors.Engines.Gpu.IGpuTensor-1.html">IGpuTensor</a>&lt;T&gt;[]</dt>
    <dd><p>GPU tensor inputs (uses first input).</p>
</dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="AiDotNet.Tensors.Engines.Gpu.IGpuTensor-1.html">IGpuTensor</a>&lt;T&gt;</dt>
    <dd><p>GPU tensor output after routing through experts and combining outputs.</p>
</dd>
  </dl>







  <h4 class="section" id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_ForwardGpu_AiDotNet_Tensors_Engines_Gpu_IGpuTensor__0_____remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
The GPU forward pass (all operations GPU-resident):
1. Routes input through the router network (GPU)
2. Applies softmax to get routing probabilities (GPU)
3. Optionally applies Top-K selection (GPU)
4. Passes input through each expert (GPU)
5. Combines expert outputs using routing weights (GPU)
6. Applies activation function (GPU)
Only downloads to CPU in training mode for gradient caching.
</p>
</div>




  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_GetAuxiliaryLossDiagnostics_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.GetAuxiliaryLossDiagnostics*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_GetAuxiliaryLossDiagnostics" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.GetAuxiliaryLossDiagnostics">
  GetAuxiliaryLossDiagnostics()
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L1212"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Gets diagnostic information about expert usage and load balancing.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public Dictionary&lt;string, string&gt; GetAuxiliaryLossDiagnostics()</code></pre>
  </div>


  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.collections.generic.dictionary-2">Dictionary</a>&lt;<a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a>, <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a>&gt;</dt>
    <dd><p>A dictionary containing diagnostic metrics including per-expert usage statistics,
load balancing metrics, and routing weight distributions.</p>
</dd>
  </dl>







  <h4 class="section" id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_GetAuxiliaryLossDiagnostics_remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
This method provides detailed statistics about expert usage that can be used for
monitoring training progress, debugging routing issues, and tuning load balancing parameters.
</p>
<p><b>For Beginners:</b> Gets a detailed report about how experts are being used.
<p>The returned dictionary includes:</p>
<ul>
<li><b>expert_i_tokens:</b> How many inputs were routed to expert i</li>
<li><b>expert_i_prob_mass:</b> Total routing weight for expert i across all inputs</li>
<li><b>expert_i_avg_weight:</b> Average routing weight when expert i is selected</li>
<li><b>load_balance_loss:</b> Current load balancing loss value</li>
<li><b>usage_variance:</b> Variance in expert usage (lower is better balanced)</li>
<li><b>max_min_ratio:</b> Ratio of most-used to least-used expert (1.0 is perfect)</li>
</ul>
<p>Use this information to:</p>
<ul>
<li>Monitor if experts are being used balanced or if some are overused</li>
<li>Decide if you need to adjust the load balancing weight</li>
<li>Detect expert collapse (all inputs routed to one expert)</li>
<li>Track training health over time</li>
</ul>
<p>Example output:
{
&quot;expert_0_tokens&quot;: &quot;245&quot;,
&quot;expert_1_tokens&quot;: &quot;198&quot;,
&quot;expert_2_tokens&quot;: &quot;223&quot;,
&quot;expert_3_tokens&quot;: &quot;234&quot;,
&quot;expert_0_prob_mass&quot;: &quot;0.28&quot;,
&quot;expert_1_prob_mass&quot;: &quot;0.22&quot;,
...
&quot;load_balance_loss&quot;: &quot;0.253&quot;,
&quot;usage_variance&quot;: &quot;0.0012&quot;,
&quot;max_min_ratio&quot;: &quot;1.24&quot;
}</p>

</div>




  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_GetDiagnostics_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.GetDiagnostics*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_GetDiagnostics" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.GetDiagnostics">
  GetDiagnostics()
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L1316"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Gets diagnostic information about this component's state and behavior.
Overrides <a class="xref" href="AiDotNet.NeuralNetworks.Layers.LayerBase-1.html#AiDotNet_NeuralNetworks_Layers_LayerBase_1_GetDiagnostics">GetDiagnostics()</a> to include auxiliary loss diagnostics.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public override Dictionary&lt;string, string&gt; GetDiagnostics()</code></pre>
  </div>


  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.collections.generic.dictionary-2">Dictionary</a>&lt;<a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a>, <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a>&gt;</dt>
    <dd><p>A dictionary containing diagnostic metrics including both base layer diagnostics and
auxiliary loss diagnostics from <a class="xref" href="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer-1.html#AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_GetAuxiliaryLossDiagnostics">GetAuxiliaryLossDiagnostics()</a>.</p>
</dd>
  </dl>











  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_GetParameters_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.GetParameters*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_GetParameters" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.GetParameters">
  GetParameters()
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L830"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Gets all trainable parameters as a single vector.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public override Vector&lt;T&gt; GetParameters()</code></pre>
  </div>


  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="AiDotNet.Tensors.LinearAlgebra.Vector-1.html">Vector</a>&lt;T&gt;</dt>
    <dd><p>A vector containing all parameters from the router and all experts.</p>
</dd>
  </dl>







  <h4 class="section" id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_GetParameters_remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
Parameters are ordered as: [router parameters] [expert1 parameters] [expert2 parameters] ...
</p>
<p><b>For Beginners:</b> Collects all learned values into one list.
<p>The returned vector contains:</p>
<ul>
<li>First, all parameters from the router</li>
<li>Then, all parameters from expert 1</li>
<li>Then, all parameters from expert 2</li>
<li>And so on</li>
</ul>
<p>This is useful for:</p>
<ul>
<li>Saving the entire MoE model to disk</li>
<li>Implementing advanced optimization algorithms</li>
<li>Analyzing the model's learned parameters</li>
<li>Transferring knowledge to another model</li>
</ul>

</div>




  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_ResetState_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.ResetState*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_ResetState" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.ResetState">
  ResetState()
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L928"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Resets the internal state of the layer, clearing all cached values.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public override void ResetState()</code></pre>
  </div>









  <h4 class="section" id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_ResetState_remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
This clears cached values from forward/backward passes and resets the state of the router
and all experts. Call this between training batches or when switching between training and inference.
</p>
<p><b>For Beginners:</b> Clears the layer's "short-term memory".
<p>This resets:</p>
<ul>
<li>Cached inputs and outputs</li>
<li>Routing weights and decisions</li>
<li>Expert activations</li>
<li>All temporary values used for learning</li>
</ul>
<p>When to call this:</p>
<ul>
<li>Between different batches of training data</li>
<li>When switching from training to testing mode</li>
<li>Before processing a new, unrelated input</li>
</ul>
<p>This ensures that information from one batch doesn't leak into the next batch,
which could cause incorrect gradient calculations or predictions.</p>

</div>




  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_SetParameters_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.SetParameters*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_SetParameters_AiDotNet_Tensors_LinearAlgebra_Vector__0__" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.SetParameters(AiDotNet.Tensors.LinearAlgebra.Vector{`0})">
  SetParameters(Vector&lt;T&gt;)
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L876"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Sets all trainable parameters from a single vector.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public override void SetParameters(Vector&lt;T&gt; parameters)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>parameters</code> <a class="xref" href="AiDotNet.Tensors.LinearAlgebra.Vector-1.html">Vector</a>&lt;T&gt;</dt>
    <dd><p>A vector containing parameters for the router and all experts.</p>
</dd>
  </dl>








  <h4 class="section" id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_SetParameters_AiDotNet_Tensors_LinearAlgebra_Vector__0___remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
Parameters should be in the same order as returned by GetParameters():
[router parameters] [expert1 parameters] [expert2 parameters] ...
</p>
<p><b>For Beginners:</b> Loads previously saved parameters back into the model.
<p>This is the opposite of GetParameters():</p>
<ul>
<li>Takes a vector of all parameters</li>
<li>Distributes them to the router and experts</li>
<li>Must match the exact format returned by GetParameters()</li>
</ul>
<p>Use this to:</p>
<ul>
<li>Load a saved model from disk</li>
<li>Initialize with pre-trained parameters</li>
<li>Implement custom optimization algorithms</li>
</ul>
<p>If the parameter count doesn't match exactly, an error is thrown to prevent
accidentally corrupting the model.</p>

</div>

  <h4 class="section">Exceptions</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.argumentexception">ArgumentException</a></dt>
    <dd><p>Thrown when the parameter count doesn't match.</p>
</dd>
  </dl>



  <a id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_UpdateParameters_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.UpdateParameters*"></a>

  <h3 id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_UpdateParameters__0_" data-uid="AiDotNet.NeuralNetworks.Layers.MixtureOfExpertsLayer`1.UpdateParameters(`0)">
  UpdateParameters(T)
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L792"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Updates all trainable parameters using the specified learning rate.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public override void UpdateParameters(T learningRate)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>learningRate</code> <span class="xref">T</span></dt>
    <dd><p>The learning rate for parameter updates.</p>
</dd>
  </dl>








  <h4 class="section" id="AiDotNet_NeuralNetworks_Layers_MixtureOfExpertsLayer_1_UpdateParameters__0__remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
This method updates parameters for both the router and all expert networks that support training.
</p>
<p><b>For Beginners:</b> This applies all the learned improvements to the router and experts.
<p>After the backward pass calculated how everything should change:</p>
<ul>
<li>The router updates its weights to make better routing decisions</li>
<li>Each expert updates its weights to make better predictions</li>
<li>The learning rate controls how big these updates are</li>
</ul>
<p>Learning rate guidelines:</p>
<ul>
<li>Too small: Learning is very slow but stable</li>
<li>Too large: Learning is fast but might be unstable</li>
<li>Just right: Balances speed and stability (often 0.001 to 0.01)</li>
</ul>
<p>After calling this method, the MoE layer should perform slightly better than before.</p>

</div>





</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/ooples/AiDotNet/blob/master/src/NeuralNetworks/Layers/MixtureOfExpertsLayer.cs/#L56" class="edit-link">Edit this page</a>
        </div>


      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          AiDotNet - Enterprise AI/ML Library for .NET
        </div>
      </div>
    </footer>
  </body>
</html>
