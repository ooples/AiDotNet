<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Interface IAuxiliaryLossLayer&lt;T&gt; | AiDotNet Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Interface IAuxiliaryLossLayer&lt;T&gt; | AiDotNet Documentation ">
      
      <meta name="description" content="Interface for neural network layers that report auxiliary losses in addition to the primary task loss. Extends IDiagnosticsProvider&amp;lt;T&amp;gt; to provide diagnostic information about auxiliary loss computation.">
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/ooples/AiDotNet/new/master/apiSpec/new?filename=AiDotNet_Interfaces_IAuxiliaryLossLayer_1.md&amp;value=---%0Auid%3A%20AiDotNet.Interfaces.IAuxiliaryLossLayer%601%0Asummary%3A%20&#39;*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax&#39;%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="ManagedReference">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../logo.svg" alt="AiDotNet">
            AiDotNet
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="AiDotNet.Interfaces.IAuxiliaryLossLayer`1">



  <h1 id="AiDotNet_Interfaces_IAuxiliaryLossLayer_1" data-uid="AiDotNet.Interfaces.IAuxiliaryLossLayer`1" class="text-break">
Interface IAuxiliaryLossLayer&lt;T&gt;  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/Interfaces/IAuxiliaryLossLayer.cs/#L72"><i class="bi bi-code-slash"></i></a>
  </h1>

  <div class="facts text-secondary">
    <dl><dt>Namespace</dt><dd><a class="xref" href="AiDotNet.html">AiDotNet</a>.<a class="xref" href="AiDotNet.Interfaces.html">Interfaces</a></dd></dl>
  <dl><dt>Assembly</dt><dd>AiDotNet.dll</dd></dl>
  </div>

  <div class="markdown summary"><p>Interface for neural network layers that report auxiliary losses in addition to the primary task loss.
Extends IDiagnosticsProvider&lt;T&gt; to provide diagnostic information about auxiliary loss computation.</p>
</div>
  <div class="markdown conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public interface IAuxiliaryLossLayer&lt;T&gt; : IDiagnosticsProvider</code></pre>
  </div>



  <h4 class="section">Type Parameters</h4>
  <dl class="parameters">
    <dt><code>T</code></dt>
    <dd><p>The numeric type used for calculations (e.g., float, double).</p>
</dd>
  </dl>




  <dl class="typelist inheritedMembers">
    <dt>Inherited Members</dt>
    <dd>
    <div>
      <a class="xref" href="AiDotNet.Interfaces.IDiagnosticsProvider.html#AiDotNet_Interfaces_IDiagnosticsProvider_GetDiagnostics">IDiagnosticsProvider.GetDiagnostics()</a>
    </div>
  </dd></dl>




  <h2 id="AiDotNet_Interfaces_IAuxiliaryLossLayer_1_remarks">Remarks</h2>
  <div class="markdown level0 remarks"><p>
Auxiliary losses are additional loss terms that help guide training beyond the primary task objective.
They are particularly useful in complex architectures where certain desirable properties (like
balanced resource utilization or regularization) need explicit encouragement during training.
</p>
<p>
<b>For Beginners:</b> Think of auxiliary losses as "side goals" for training a neural network.
<p>While the primary loss tells the network &quot;make accurate predictions,&quot; auxiliary losses add
additional objectives like:</p>
<ul>
<li>&quot;Use all experts equally&quot; (load balancing in Mixture-of-Experts)</li>
<li>&quot;Keep activations small&quot; (regularization)</li>
<li>&quot;Learn similar representations&quot; (similarity objectives)</li>
</ul>
<p>Real-world analogy:
Imagine you're training to be a chef (primary goal: make delicious food). But you also have
auxiliary goals:</p>
<ul>
<li>Keep your workspace clean (regularization)</li>
<li>Use all your tools equally (load balancing)</li>
<li>Work efficiently (computational constraints)</li>
</ul>
<p>These auxiliary goals don't directly make the food taste better, but they help you become
a better, more well-rounded chef.</p>
<p>In the training loop, auxiliary losses are typically combined with the primary loss:</p>
<pre><code class="lang-csharp">total_loss = primary_loss + (alpha * auxiliary_loss)</code></pre>
<p>Where alpha is a weight that balances the importance of the auxiliary objective.</p>

<p>
<b>Common Use Cases:</b>
<ul><li><b>Load Balancing (MoE):</b> Encourage balanced expert usage to prevent some experts from being underutilized</li><li><b>Sparsity Regularization:</b> Encourage sparse activations to improve efficiency</li><li><b>Contrastive Learning:</b> Encourage similar inputs to have similar representations</li><li><b>Multi-Task Learning:</b> Additional task objectives that share representations</li></ul>

<p>
<b>Implementation Example:</b>
<pre><code class="lang-csharp">public class MixtureOfExpertsLayer&lt;T&gt; : LayerBase&lt;T&gt;, IAuxiliaryLossLayer&lt;T&gt;
{
    public T ComputeAuxiliaryLoss()
    {
        // Compute load balancing loss
        return CalculateLoadBalancingLoss();
    }
}

// In training loop:
var primaryLoss = lossFunction.CalculateLoss(predictions, targets);
var auxiliaryLoss = NumOps.Zero;
if (layer is IAuxiliaryLossLayer&lt;T&gt; auxLayer)
{
    auxiliaryLoss = auxLayer.ComputeAuxiliaryLoss();
}
var totalLoss = NumOps.Add(primaryLoss, NumOps.Multiply(alpha, auxiliaryLoss));</code></pre>

</div>


  <h2 class="section" id="properties">Properties
</h2>


  <a id="AiDotNet_Interfaces_IAuxiliaryLossLayer_1_AuxiliaryLossWeight_" data-uid="AiDotNet.Interfaces.IAuxiliaryLossLayer`1.AuxiliaryLossWeight*"></a>

  <h3 id="AiDotNet_Interfaces_IAuxiliaryLossLayer_1_AuxiliaryLossWeight" data-uid="AiDotNet.Interfaces.IAuxiliaryLossLayer`1.AuxiliaryLossWeight">
  AuxiliaryLossWeight
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/Interfaces/IAuxiliaryLossLayer.cs/#L190"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Gets or sets the weight (coefficient) for the auxiliary loss.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">T AuxiliaryLossWeight { get; set; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><span class="xref">T</span></dt>
    <dd><p>The weight to multiply the auxiliary loss by before adding it to the total loss.
Typically a small value like 0.01 to 0.1.</p>
</dd>
  </dl>




  <h4 class="section" id="AiDotNet_Interfaces_IAuxiliaryLossLayer_1_AuxiliaryLossWeight_remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
The auxiliary loss weight (often denoted as alpha or lambda) controls how much the auxiliary
objective influences training relative to the primary objective. A higher weight means the
auxiliary loss has more influence.
</p>
<p>
<b>For Beginners:</b> Controls how important the auxiliary loss is relative to the main loss.
<p>The auxiliary loss weight balances two objectives:</p>
<ul>
<li>Primary objective: Make accurate predictions (main loss)</li>
<li>Auxiliary objective: Satisfy the side goal (auxiliary loss)</li>
</ul>
<p>Total loss = primary_loss + (AuxiliaryLossWeight * auxiliary_loss)</p>
<p>Choosing the right weight:</p>
<ul>
<li>Too small (e.g., 0.001): Auxiliary loss has little effect, side goal ignored</li>
<li>Too large (e.g., 1.0): Auxiliary loss dominates, accuracy might suffer</li>
<li>Just right (e.g., 0.01-0.1): Balances both objectives</li>
</ul>
<p>Example:
If AuxiliaryLossWeight = 0.01:</p>
<ul>
<li>Primary loss of 2.5 contributes: 2.5</li>
<li>Auxiliary loss of 10.0 contributes: 0.1 (10.0 * 0.01)</li>
<li>Total loss: 2.6</li>
</ul>
<p>This way, the main task is still the priority, but the side goal provides some guidance.</p>
<p>You often need to tune this value experimentally:</p>
<ol>
<li>Start with a small value (e.g., 0.01)</li>
<li>Monitor both losses during training</li>
<li>Increase if the auxiliary objective isn't being achieved</li>
<li>Decrease if the primary task accuracy suffers</li>
</ol>

</div>




  <a id="AiDotNet_Interfaces_IAuxiliaryLossLayer_1_UseAuxiliaryLoss_" data-uid="AiDotNet.Interfaces.IAuxiliaryLossLayer`1.UseAuxiliaryLoss*"></a>

  <h3 id="AiDotNet_Interfaces_IAuxiliaryLossLayer_1_UseAuxiliaryLoss" data-uid="AiDotNet.Interfaces.IAuxiliaryLossLayer`1.UseAuxiliaryLoss">
  UseAuxiliaryLoss
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/Interfaces/IAuxiliaryLossLayer.cs/#L146"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">bool UseAuxiliaryLoss { get; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.boolean">bool</a></dt>
    <dd></dd>
  </dl>








  <h2 class="section" id="methods">Methods
</h2>


  <a id="AiDotNet_Interfaces_IAuxiliaryLossLayer_1_ComputeAuxiliaryLoss_" data-uid="AiDotNet.Interfaces.IAuxiliaryLossLayer`1.ComputeAuxiliaryLoss*"></a>

  <h3 id="AiDotNet_Interfaces_IAuxiliaryLossLayer_1_ComputeAuxiliaryLoss" data-uid="AiDotNet.Interfaces.IAuxiliaryLossLayer`1.ComputeAuxiliaryLoss">
  ComputeAuxiliaryLoss()
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/Interfaces/IAuxiliaryLossLayer.cs/#L114"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Computes the auxiliary loss for this layer based on the most recent forward pass.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">T ComputeAuxiliaryLoss()</code></pre>
  </div>


  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><span class="xref">T</span></dt>
    <dd><p>The auxiliary loss value.</p>
</dd>
  </dl>







  <h4 class="section" id="AiDotNet_Interfaces_IAuxiliaryLossLayer_1_ComputeAuxiliaryLoss_remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>
This method calculates an additional loss term that is added to the primary task loss during training.
The auxiliary loss typically encourages desirable properties like balanced resource usage,
sparsity, or other architectural constraints.
</p>
<p>
The auxiliary loss should be computed based on cached values from the most recent forward pass.
It is typically called after the forward pass but before the backward pass, and its value is
added to the primary loss before computing gradients.
</p>
<p>
<b>For Beginners:</b> This method calculates the "side goal" loss for the layer.
<p>When this method is called:</p>
<ul>
<li>The layer has just finished its forward pass</li>
<li>It has cached information about what happened (e.g., which experts were used)</li>
<li>It uses this information to compute an auxiliary loss</li>
</ul>
<p>For example, in a Mixture-of-Experts layer with load balancing:</p>
<ol>
<li>During forward pass, track which experts were selected</li>
<li>When ComputeAuxiliaryLoss() is called, calculate how imbalanced the usage was</li>
<li>Return a loss value that's higher when usage is more imbalanced</li>
<li>This encourages the training to use all experts more equally</li>
</ol>
<p>The returned value should be:</p>
<ul>
<li>Zero or near-zero when the auxiliary objective is satisfied</li>
<li>Higher when the objective is violated</li>
<li>Always non-negative</li>
</ul>
<p>This loss gets added to the main loss, so the training process tries to minimize both.</p>

</div>

  <h4 class="section">Exceptions</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.invalidoperationexception">InvalidOperationException</a></dt>
    <dd><p>Thrown when ComputeAuxiliaryLoss is called before a forward pass has been performed.</p>
</dd>
  </dl>



  <a id="AiDotNet_Interfaces_IAuxiliaryLossLayer_1_GetAuxiliaryLossDiagnostics_" data-uid="AiDotNet.Interfaces.IAuxiliaryLossLayer`1.GetAuxiliaryLossDiagnostics*"></a>

  <h3 id="AiDotNet_Interfaces_IAuxiliaryLossLayer_1_GetAuxiliaryLossDiagnostics" data-uid="AiDotNet.Interfaces.IAuxiliaryLossLayer`1.GetAuxiliaryLossDiagnostics">
  GetAuxiliaryLossDiagnostics()
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/Interfaces/IAuxiliaryLossLayer.cs/#L248"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">Dictionary&lt;string, string&gt; GetAuxiliaryLossDiagnostics()</code></pre>
  </div>


  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.collections.generic.dictionary-2">Dictionary</a>&lt;<a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a>, <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a>&gt;</dt>
    <dd></dd>
  </dl>












</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/ooples/AiDotNet/blob/master/src/Interfaces/IAuxiliaryLossLayer.cs/#L72" class="edit-link">Edit this page</a>
        </div>


      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          AiDotNet - Enterprise AI/ML Library for .NET
        </div>
      </div>
    </footer>
  </body>
</html>
