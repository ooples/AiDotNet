<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Class MaximalMarginalRelevanceReranker&lt;T&gt; | AiDotNet Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Class MaximalMarginalRelevanceReranker&lt;T&gt; | AiDotNet Documentation ">
      
      <meta name="description" content="Implements Maximal Marginal Relevance (MMR) reranking to balance relevance and diversity.">
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/ooples/AiDotNet/new/master/apiSpec/new?filename=AiDotNet_RetrievalAugmentedGeneration_Rerankers_MaximalMarginalRelevanceReranker_1.md&amp;value=---%0Auid%3A%20AiDotNet.RetrievalAugmentedGeneration.Rerankers.MaximalMarginalRelevanceReranker%601%0Asummary%3A%20&#39;*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax&#39;%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="ManagedReference">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../logo.svg" alt="AiDotNet">
            AiDotNet
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="AiDotNet.RetrievalAugmentedGeneration.Rerankers.MaximalMarginalRelevanceReranker`1">



  <h1 id="AiDotNet_RetrievalAugmentedGeneration_Rerankers_MaximalMarginalRelevanceReranker_1" data-uid="AiDotNet.RetrievalAugmentedGeneration.Rerankers.MaximalMarginalRelevanceReranker`1" class="text-break">
Class MaximalMarginalRelevanceReranker&lt;T&gt;  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/RetrievalAugmentedGeneration/Rerankers/MaximalMarginalRelevanceReranker.cs/#L66"><i class="bi bi-code-slash"></i></a>
  </h1>

  <div class="facts text-secondary">
    <dl><dt>Namespace</dt><dd><a class="xref" href="AiDotNet.html">AiDotNet</a>.<a class="xref" href="AiDotNet.RetrievalAugmentedGeneration.html">RetrievalAugmentedGeneration</a>.<a class="xref" href="AiDotNet.RetrievalAugmentedGeneration.Rerankers.html">Rerankers</a></dd></dl>
  <dl><dt>Assembly</dt><dd>AiDotNet.dll</dd></dl>
  </div>

  <div class="markdown summary"><p>Implements Maximal Marginal Relevance (MMR) reranking to balance relevance and diversity.</p>
</div>
  <div class="markdown conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public class MaximalMarginalRelevanceReranker&lt;T&gt; : RerankerBase&lt;T&gt;, IReranker&lt;T&gt;</code></pre>
  </div>



  <h4 class="section">Type Parameters</h4>
  <dl class="parameters">
    <dt><code>T</code></dt>
    <dd><p>The numeric data type used for calculations.</p>
</dd>
  </dl>

  <dl class="typelist inheritance">
    <dt>Inheritance</dt>
    <dd>
      <div><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object">object</a></div>
      <div><a class="xref" href="AiDotNet.RetrievalAugmentedGeneration.Rerankers.RerankerBase-1.html">RerankerBase</a>&lt;T&gt;</div>
      <div><span class="xref">MaximalMarginalRelevanceReranker&lt;T&gt;</span></div>
    </dd>
  </dl>

  <dl class="typelist implements">
    <dt>Implements</dt>
    <dd>
      <div><a class="xref" href="AiDotNet.Interfaces.IReranker-1.html">IReranker</a>&lt;T&gt;</div>
    </dd>
  </dl>


  <dl class="typelist inheritedMembers">
    <dt>Inherited Members</dt>
    <dd>
    <div>
      <a class="xref" href="AiDotNet.RetrievalAugmentedGeneration.Rerankers.RerankerBase-1.html#AiDotNet_RetrievalAugmentedGeneration_Rerankers_RerankerBase_1_NumOps">RerankerBase&lt;T&gt;.NumOps</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.RetrievalAugmentedGeneration.Rerankers.RerankerBase-1.html#AiDotNet_RetrievalAugmentedGeneration_Rerankers_RerankerBase_1_Rerank_System_String_System_Collections_Generic_IEnumerable_AiDotNet_RetrievalAugmentedGeneration_Models_Document__0___">RerankerBase&lt;T&gt;.Rerank(string, IEnumerable&lt;Document&lt;T&gt;&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.RetrievalAugmentedGeneration.Rerankers.RerankerBase-1.html#AiDotNet_RetrievalAugmentedGeneration_Rerankers_RerankerBase_1_Rerank_System_String_System_Collections_Generic_IEnumerable_AiDotNet_RetrievalAugmentedGeneration_Models_Document__0___System_Int32_">RerankerBase&lt;T&gt;.Rerank(string, IEnumerable&lt;Document&lt;T&gt;&gt;, int)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.RetrievalAugmentedGeneration.Rerankers.RerankerBase-1.html#AiDotNet_RetrievalAugmentedGeneration_Rerankers_RerankerBase_1_ValidateQuery_System_String_">RerankerBase&lt;T&gt;.ValidateQuery(string)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.RetrievalAugmentedGeneration.Rerankers.RerankerBase-1.html#AiDotNet_RetrievalAugmentedGeneration_Rerankers_RerankerBase_1_ValidateDocuments_System_Collections_Generic_IEnumerable_AiDotNet_RetrievalAugmentedGeneration_Models_Document__0___">RerankerBase&lt;T&gt;.ValidateDocuments(IEnumerable&lt;Document&lt;T&gt;&gt;)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.RetrievalAugmentedGeneration.Rerankers.RerankerBase-1.html#AiDotNet_RetrievalAugmentedGeneration_Rerankers_RerankerBase_1_ValidateTopK_System_Int32_">RerankerBase&lt;T&gt;.ValidateTopK(int)</a>
    </div>
    <div>
      <a class="xref" href="AiDotNet.RetrievalAugmentedGeneration.Rerankers.RerankerBase-1.html#AiDotNet_RetrievalAugmentedGeneration_Rerankers_RerankerBase_1_NormalizeScores_System_Collections_Generic_IList_AiDotNet_RetrievalAugmentedGeneration_Models_Document__0___">RerankerBase&lt;T&gt;.NormalizeScores(IList&lt;Document&lt;T&gt;&gt;)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.equals#system-object-equals(system-object)">object.Equals(object)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.equals#system-object-equals(system-object-system-object)">object.Equals(object, object)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.gethashcode">object.GetHashCode()</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.gettype">object.GetType()</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.memberwiseclone">object.MemberwiseClone()</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.referenceequals">object.ReferenceEquals(object, object)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.tostring">object.ToString()</a>
    </div>
  </dd></dl>




  <h2 id="AiDotNet_RetrievalAugmentedGeneration_Rerankers_MaximalMarginalRelevanceReranker_1_remarks">Remarks</h2>
  <div class="markdown level0 remarks"><p>
MMR reranking ensures that retrieved documents are not only relevant to the query but also
diverse from each other. This prevents redundancy where all top results say essentially the
same thing, providing users with a broader range of information. MMR is particularly valuable
for exploratory search, news aggregation, and research applications.
</p>
<p><b>For Beginners:</b> MMR prevents search results from being too similar to each other.
<p>The problem MMR solves:
Imagine searching for &quot;climate change&quot; and getting:</p>
<ol>
<li>&quot;Climate change threatens polar bears&quot;</li>
<li>&quot;Polar bears endangered by climate change&quot;</li>
<li>&quot;Climate change impact on polar ice affecting bears&quot;</li>
<li>&quot;Global warming threatens polar bear habitats&quot;</li>
<li>&quot;Arctic ice melting endangers polar bears&quot;</li>
</ol>
<p>All relevant, but they're all saying the same thing! You're getting one narrow aspect
repeated 5 times instead of a diverse view of climate change.</p>
<p>What MMR does instead:</p>
<ol>
<li>&quot;Climate change threatens polar bears&quot; (relevant: ✓, diverse: ✓ first result)</li>
<li>&quot;Rising sea levels threaten coastal cities&quot; (relevant: ✓, different topic: ✓)</li>
<li>&quot;Carbon emissions reach record highs&quot; (relevant: ✓, different aspect: ✓)</li>
<li>&quot;Renewable energy adoption accelerates globally&quot; (relevant: ✓, solutions angle: ✓)</li>
<li>&quot;Climate refugees increase in developing nations&quot; (relevant: ✓, human impact: ✓)</li>
</ol>
<p>Now you get a comprehensive view with diverse perspectives!</p>
<p>How MMR works:</p>
<ol>
<li>Pick the most relevant document → Add to results</li>
<li>For next pick, consider:
<ul>
<li>Relevance to query (you want relevant docs)</li>
<li>Dissimilarity to already-picked docs (you want diversity)</li>
</ul>
</li>
<li>Balance these two goals with a lambda parameter</li>
<li>Repeat until you have K documents</li>
</ol>
<p>The lambda parameter (λ):</p>
<ul>
<li>λ = 1.0: Only care about relevance (normal ranking, no diversity)</li>
<li>λ = 0.0: Only care about diversity (might get irrelevant but diverse docs)</li>
<li>λ = 0.7: Balanced (70% relevance, 30% diversity) ← Good default</li>
</ul>
<p>When to use MMR:</p>
<ul>
<li>Research/exploratory queries: Users want comprehensive coverage</li>
<li>News aggregation: Don't show 10 articles about the same event</li>
<li>Product search: Show variety, not just variations of one product</li>
<li>Question answering: Provide multiple perspectives</li>
</ul>
<p>When NOT to use MMR:</p>
<ul>
<li>User wants very specific info: &quot;iPhone 15 Pro Max price&quot; (diversity not helpful)</li>
<li>Transactional queries: &quot;buy Nike Air Max&quot; (user knows what they want)</li>
<li>Fact lookups: &quot;Paris population&quot; (one correct answer)</li>
</ul>

</div>


  <h2 class="section" id="constructors">Constructors
</h2>


  <a id="AiDotNet_RetrievalAugmentedGeneration_Rerankers_MaximalMarginalRelevanceReranker_1__ctor_" data-uid="AiDotNet.RetrievalAugmentedGeneration.Rerankers.MaximalMarginalRelevanceReranker`1.#ctor*"></a>

  <h3 id="AiDotNet_RetrievalAugmentedGeneration_Rerankers_MaximalMarginalRelevanceReranker_1__ctor_System_Func_AiDotNet_RetrievalAugmentedGeneration_Models_Document__0__AiDotNet_Tensors_LinearAlgebra_Vector__0___System_Double_" data-uid="AiDotNet.RetrievalAugmentedGeneration.Rerankers.MaximalMarginalRelevanceReranker`1.#ctor(System.Func{AiDotNet.RetrievalAugmentedGeneration.Models.Document{`0},AiDotNet.Tensors.LinearAlgebra.Vector{`0}},System.Double)">
  MaximalMarginalRelevanceReranker(Func&lt;Document&lt;T&gt;, Vector&lt;T&gt;&gt;, double)
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/RetrievalAugmentedGeneration/Rerankers/MaximalMarginalRelevanceReranker.cs/#L111"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Initializes a new instance of the MaximalMarginalRelevanceReranker class.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public MaximalMarginalRelevanceReranker(Func&lt;Document&lt;T&gt;, Vector&lt;T&gt;&gt; getEmbedding, double lambda = 0.7)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>getEmbedding</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.func-2">Func</a>&lt;<a class="xref" href="AiDotNet.RetrievalAugmentedGeneration.Models.Document-1.html">Document</a>&lt;T&gt;, <a class="xref" href="AiDotNet.Tensors.LinearAlgebra.Vector-1.html">Vector</a>&lt;T&gt;&gt;</dt>
    <dd><p>Function to get document embeddings for similarity calculation.</p>
</dd>
    <dt><code>lambda</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.double">double</a></dt>
    <dd><p>Balance between relevance and diversity (0-1, default: 0.7). Higher values prioritize relevance.</p>
</dd>
  </dl>








  <h4 class="section" id="AiDotNet_RetrievalAugmentedGeneration_Rerankers_MaximalMarginalRelevanceReranker_1__ctor_System_Func_AiDotNet_RetrievalAugmentedGeneration_Models_Document__0__AiDotNet_Tensors_LinearAlgebra_Vector__0___System_Double__remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p><b>For Beginners:</b> Configuration explained.
<p><strong>getEmbedding Function:</strong>
This function should return the vector embedding of a document. If you don't have
embeddings, you can't use MMR (it needs to measure similarity between documents).</p>
<p>Example:</p>
<pre><code class="lang-csharp">Func&lt;Document&lt;double&gt;, Vector&lt;double&gt;&gt; getEmb = (doc) =&gt; {
    // Return cached embedding if available
    if (doc.Metadata.ContainsKey(&quot;embedding&quot;))
        return (Vector&lt;double&gt;)doc.Metadata[&quot;embedding&quot;];

    // Otherwise compute it
    return embeddingModel.Encode(doc.Content);
};
</code></pre>
<p><strong>Lambda Parameter Guidelines:</strong></p>
<ul>
<li>1.0 = Pure relevance (same as no reranking)</li>
<li>0.9 = Slight diversity boost</li>
<li>0.7 = Balanced (recommended default)</li>
<li>0.5 = Equal weight to relevance and diversity</li>
<li>0.3 = Heavy diversity (may sacrifice relevance)</li>
<li>0.0 = Pure diversity (probably too extreme)</li>
</ul>
<p>Start with 0.7 and adjust based on user feedback!</p>

</div>




  <h2 class="section" id="properties">Properties
</h2>


  <a id="AiDotNet_RetrievalAugmentedGeneration_Rerankers_MaximalMarginalRelevanceReranker_1_ModifiesScores_" data-uid="AiDotNet.RetrievalAugmentedGeneration.Rerankers.MaximalMarginalRelevanceReranker`1.ModifiesScores*"></a>

  <h3 id="AiDotNet_RetrievalAugmentedGeneration_Rerankers_MaximalMarginalRelevanceReranker_1_ModifiesScores" data-uid="AiDotNet.RetrievalAugmentedGeneration.Rerankers.MaximalMarginalRelevanceReranker`1.ModifiesScores">
  ModifiesScores
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/RetrievalAugmentedGeneration/Rerankers/MaximalMarginalRelevanceReranker.cs/#L74"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Gets a value indicating whether this reranker modifies relevance scores.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public override bool ModifiesScores { get; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.boolean">bool</a></dt>
    <dd></dd>
  </dl>








  <h2 class="section" id="methods">Methods
</h2>


  <a id="AiDotNet_RetrievalAugmentedGeneration_Rerankers_MaximalMarginalRelevanceReranker_1_RerankCore_" data-uid="AiDotNet.RetrievalAugmentedGeneration.Rerankers.MaximalMarginalRelevanceReranker`1.RerankCore*"></a>

  <h3 id="AiDotNet_RetrievalAugmentedGeneration_Rerankers_MaximalMarginalRelevanceReranker_1_RerankCore_System_String_System_Collections_Generic_IList_AiDotNet_RetrievalAugmentedGeneration_Models_Document__0___" data-uid="AiDotNet.RetrievalAugmentedGeneration.Rerankers.MaximalMarginalRelevanceReranker`1.RerankCore(System.String,System.Collections.Generic.IList{AiDotNet.RetrievalAugmentedGeneration.Models.Document{`0}})">
  RerankCore(string, IList&lt;Document&lt;T&gt;&gt;)
  <a class="header-action link-secondary" title="View source" href="https://github.com/ooples/AiDotNet/blob/master/src/RetrievalAugmentedGeneration/Rerankers/MaximalMarginalRelevanceReranker.cs/#L126"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Reranks documents using Maximal Marginal Relevance.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">protected override IEnumerable&lt;Document&lt;T&gt;&gt; RerankCore(string query, IList&lt;Document&lt;T&gt;&gt; documents)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>query</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.string">string</a></dt>
    <dd></dd>
    <dt><code>documents</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.collections.generic.ilist-1">IList</a>&lt;<a class="xref" href="AiDotNet.RetrievalAugmentedGeneration.Models.Document-1.html">Document</a>&lt;T&gt;&gt;</dt>
    <dd></dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.collections.generic.ienumerable-1">IEnumerable</a>&lt;<a class="xref" href="AiDotNet.RetrievalAugmentedGeneration.Models.Document-1.html">Document</a>&lt;T&gt;&gt;</dt>
    <dd></dd>
  </dl>












</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/ooples/AiDotNet/blob/master/src/RetrievalAugmentedGeneration/Rerankers/MaximalMarginalRelevanceReranker.cs/#L66" class="edit-link">Edit this page</a>
        </div>


      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          AiDotNet - Enterprise AI/ML Library for .NET
        </div>
      </div>
    </footer>
  </body>
</html>
